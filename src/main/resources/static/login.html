<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - EduPath AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script>
      tailwind.config = { theme: { extend: { colors: { primary: "#13b6ec" } } } }
  </script>
</head>
<body class="bg-[#f6f8f8] font-['Inter'] min-h-screen flex items-center justify-center p-4">

  <div class="bg-white w-full max-w-[420px] p-10 rounded-[2.5rem] shadow-xl text-center">
    <div class="inline-flex items-center justify-center w-16 h-16 bg-sky-50 rounded-full mb-4">
      <span class="material-symbols-outlined text-primary text-4xl">account_circle</span>
    </div>

    <h1 class="text-3xl font-black text-gray-800 mb-1">Welcome Back</h1>
    <p class="text-gray-500 text-sm mb-8">Log in to continue your journey</p>
    
    <div class="space-y-4 text-left">
      <div>
        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Email</label>
        <input type="email" id="email" placeholder="name@college.edu" 
        class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-primary focus:outline-none transition">
      </div>

      <div class="relative">
        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Password</label>
        <input type="password" id="password" placeholder="••••••••" 
        class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-primary focus:outline-none transition">
        <a href="forget.html" class="absolute right-1 -bottom-4 text-xs font-bold text-primary hover:underline">Forgot Password?</a>
      </div>

      <button id="loginBtn" class="w-full bg-primary hover:bg-[#11a5d6] text-white font-black py-4 rounded-xl shadow-lg shadow-sky-200 transition-all mt-8">
        Login
      </button>
    </div>

    <div id="loginMessage" class="mt-4 hidden font-bold text-sm"></div>

    <p class="mt-10 text-gray-500 text-sm">
      Don't have an account? <a href="index.html" class="text-primary font-bold hover:underline">Sign Up</a>
    </p>
  </div>

<script>
    document.getElementById("loginBtn").addEventListener("click", async function(){
        const emailInput = document.getElementById("email").value.trim();
        const passInput = document.getElementById("password").value.trim();
        const message = document.getElementById("loginMessage");

        if(!emailInput || !passInput) {
            message.style.display = "block";
            message.style.color = "orange";
            message.innerText = "Please fill in all fields.";
            return;
        }

        message.style.display = "block";
        message.style.color = "gray";
        message.innerText = "Connecting...";

        try {
            const url = `http://localhost:5501/api/users/login?email=${encodeURIComponent(emailInput)}&password=${encodeURIComponent(passInput)}`;
            const response = await fetch(url);
            
            if (response.ok) {
                const user = await response.json();
                
                // 1. Clear old data to prevent conflicts
                localStorage.clear();
                
                // 2. Save session data (Matching the Dashboard requirements)
                localStorage.setItem("userData", JSON.stringify(user)); 
                localStorage.setItem("currentUserEmail", user.email); 
                localStorage.setItem("isLoggedIn", "true");

                message.style.color = "green";
                message.innerText = "Success! Redirecting...";
                
                // 3. Use replace to prevent back-button loops
                setTimeout(() => {
                    window.location.replace("dashboard.html");
                }, 800);
            } else {
                message.style.color = "red";
                message.innerText = "Invalid credentials. Check your email/password.";
            }
        } catch (error) {
            console.error("Fetch error:", error);
            message.style.color = "red";
            message.innerText = "Backend server not responding on 5501!";
        }
    });
</script>
</body>
</html>